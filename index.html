<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/style.css">

    <title>Star Wars RPG Game</title>
</head>

<body>
    <div class="container">
        <header>
            <h1>Star Wars RPG!</h1>
        </header>
        <div class="push"></div>
        <div id="characters">

        </div>
        <div id="your-character">
            <h2>Your Character</h2>
        </div>
        <div id="enemies-available">
            <h2>Enemies Available to Attack</h2>
        </div>
        <div id="fight-section">
            <h2>Fight Section</h2>
            <button id="attack">Attack</button>
        </div>
        <div id="defender-section">
            <h2>Defender</h2>
            <div id="defender-text"></div>
        </div>
        <div id="result">

        </div>

    </div>

    <div class="push"></div>
    <footer class="footer">
        <div class="container">
            <span> </span>
        </div>
    </footer>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="assets/js/game.js"></script>
    <script>
        $(document).ready(function () {

            // variable: list of characters in the game
            const characters = [{
                    name: "Obi Wan",
                    image: "./assets/img/obi_wan.png",
                    healthPoints: 120,
                    attackPower: 8,
                    counterAttackPower: 7
                },
                {
                    name: "Luke Skywalker",
                    image: "./assets/img/luke_skywalker.png",
                    healthPoints: 100,
                    attackPower: 10,
                    counterAttackPower: 5
                },
                {
                    name: "Darth Sidious",
                    image: "./assets/img/darth_sidious.png",
                    healthPoints: 150,
                    attackPower: 7,
                    counterAttackPower: 20
                },
                {
                    name: "Darth Maul",
                    image: "./assets/img/darth_maul.png",
                    healthPoints: 180,
                    attackPower: 4,
                    counterAttackPower: 25
                },
            ];

            // Function: renders a character on the page
            // index: index of the character in the character array
            // hp: current hp of the character
            // divClass: class of the new div to create
            function renderCharacter(index, hp, divClass) {
                var newChar = $("<div>").text(characters[index].name).attr({
                    "char-index": index,
                    "class": divClass,
                    "id": "char" + index
                });
                newChar.append($("<img>").attr({
                    "class": "char-image",
                    "src": characters[index].image,
                    "height": "100px",
                    "width": "100px"
                }));
                newChar.append($("<div>").text(hp).attr({
                    "class": "hp-label"
                }));
                return newChar;
            }

            // Function: remove a character from the game and screen
            // index: index of character to remove
            function removeCharacter(index) {
                $('#char' + index).remove();
            }

            // Variable: Attributes for the current game, will reset when startGame() is called
            let game = {
                myCharacterIndex: -1,
                myDefenderIndex: -1,
                attackerHP: 0,
                defenderHP: 0,
                attackNumber: 0,

                // Function: main attack 
                doAttack: function () {
                    // If attackerHP and defenderHP are 0, then it's a brand new game.
                    // Set the variables based on the initial HP values then do the attack
                    if (this.attackerHP == 0 && this.defenderHP == 0) {
                        this.attackerHP = characters[this.myCharacterIndex].healthPoints;
                        this.defenderHP = characters[this.myDefenderIndex].healthPoints;
                    }

                    // If both attackerHP and defenderHP are <= 0, then somebody won or lost!
                    if (this.attackerHP <= 0 || this.defenderHP <= 0) {
                        if (this.attackerHP > this
                            .defenderHP) { // You win the attack, on to the next character

                        } else { // You lose the game, so sorry :(
                            $("#result").text("You lose the game, click to replay!").append($(
                                "<button>").attr({
                                "class": "reload"
                            }).html("Refresh Page"));
                        }
                    } else { // Otherwise do the attack!
                        this.attackNumber++;
                        console.log(this);
                        //attack 
                        var attackValue = characters[this.myCharacterIndex].attackPower * this
                            .attackNumber;
                        var defendValue = characters[this.myDefenderIndex].counterAttackPower;
                        this.attackerHP -= characters[this.myDefenderIndex].counterAttackPower;
                        console.log(this.attackerHP);
                        //defender hp
                        this.defenderHP -= characters[this.myCharacterIndex].attackPower * this
                            .attackNumber;
                        console.log(this.defenderHP);
                        var attackText = "You attacked " + characters[this.myDefenderIndex].name +
                            " for " +
                            attackValue + "damage."
                        var defendText = characters[this.myDefenderIndex].name + " attacked you for " +
                            defendValue + " damage.";
                        $("#defender-text").text(attackText + defendText);

                        // Redisplay the characters with new HP values
                        $("#char" + this.myDefenderIndex + ".defender-char").remove();
                        $("#defender-section").append(renderCharacter(this.myDefenderIndex, this
                            .defenderHP, "defender-char"));
                        $("#char" + this.myCharacterIndex + ".selected-char").remove();
                        $("#your-character").append(renderCharacter(this.myCharacterIndex, this
                            .attackerHP, "selected-char"));
                    }
                }
            };

            //Function: start a new game
            function startGame() {
                // Reset the game variable
                game.myCharacterIndex = -1;
                game.myDefenderIndex = -1;
                game.attackerHP = 0;
                game.defenderHP = 0;
                game.attackNumber = 0;

                // Display the characters on the page
                characters.forEach(function (character, index) {
                    $("#characters").append(renderCharacter(index, characters[index].healthPoints,
                        "select-char"));
                });
            };

            // Bind on click for selecting the character you want to play
            $(document).on("click", ".select-char", function () {
                game.myCharacterIndex = $(this).attr("char-index");
                characters.forEach(function (character, index) {
                    if (index == game.myCharacterIndex) {
                        $("#your-character").append(renderCharacter(index, characters[index]
                            .healthPoints, "selected-char"));
                    } else {
                        $("#enemies-available").append(renderCharacter(index, characters[index]
                            .healthPoints, "enemy-char"));
                    }

                });
                $(".select-char").remove();
            });

            // Bind on click for selecting the character you want to attack
            $(document).on("click", ".enemy-char", function () {
                if (game.myDefenderIndex == -1) {
                    game.myDefenderIndex = $(this).attr("char-index");
                    $("#defender-section").append(renderCharacter(game.myDefenderIndex, characters[game
                            .myDefenderIndex].healthPoints,
                        "defender-char"));
                    $(this).remove();
                }

            });

            // Bind on click to the attack button
            $("#attack").on("click", function () {
                if (game.myDefenderIndex != -1 && game.myCharacterIndex != -1) {
                    game.doAttack();
                } else if (game.myCharacterIndex != -1) {
                    //select a new character
                } else if (game.myDefenderIndex != -1) {
                    //select a defender
                }
            });

            //
            $(document).on("click", ".reload", function () {
                location.reload(true);
            });


            startGame();
        });
    </script>
</body>

</html>